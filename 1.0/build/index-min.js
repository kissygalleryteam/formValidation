/*! formValidation - v1.0 - 2013-08-28 2:25:35 PM
* Copyright (c) 2013 知了; Licensed  */
KISSY.add("gallery/formValidation/1.0/index",function(a,b,c){function d(a){var c=this;d.superclass.constructor.call(c,a);var e=b.one("#"+this.get("form")),f=this.get("blurValidate");if(this._bindSubmit(e),f){var g=e.all("input[type=text],textarea");this.bindBlur(g)}}return Node.all,a.extend(d,c,{_bindSubmit:function(a){var b=this;a&&a.on("submit",function(){var a=!1,c=b.validateForm(),d=b.fire("testSucc",{form:b.get("form")});return c&&d&&(a=!0),a})},bindBlur:function(a){for(var c=this,d=function(){},e=function(){c.validateField(this)},f=0;f<a.length;f++)b.one(a[f]).on("focus",d).on("blur",e)},validateForm:function(a){var c=!0;a||(a=b.one("#"+this.get("form"))[0]);for(var d=0;d<a.elements.length;d++){var e=a.elements[d];"OBJECT"!=e.tagName&&(this.hideErrors(e),this.validateField(e)&&(c=!1))}return c&&this.on("testSucc",function(){return!0}),c},validateField:function(a){var b=[],c=this.get("rules"),d=a.getAttribute("data-rulenames");if(!d)return!1;for(var e=d.split(";"),f="",g=0;g<e.length;g++){var h=e[g];if(h in c&&(f=c[h],!f.test(a))){b.push(f.msg);break}}return b.length?this.showErrors(a,b,f.msg):this.hideErrors(a),b.length>0},showErrors:function(a,b,c){this.fire("showError",{ele:a,error:b,msg:c})},hideErrors:function(a){this.fire("hideError",{ele:a})}},{ATTRS:{form:{value:"formid"},rules:{value:{},setter:function(b){var c=this.get("rules");return a.mix(c,b)}},blurValidate:{value:!0}}}),d},{requires:["node","base"]});